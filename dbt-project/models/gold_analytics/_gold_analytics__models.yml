version: 2

models:
  - name: agg_sales_by_customer
    description: "Pre-aggregated customer sales metrics for BI consumption"
    columns:
      - name: customer_id
        description: "Primary key"
        data_tests:
          - not_null
          - unique
      - name: customer_tier
        data_tests:
          - not_null
          - accepted_values:
              values: ['VIP', 'Premium', 'Regular', 'New']
      - name: total_orders
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
      - name: total_spent
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

  - name: agg_sales_by_product
    description: "Pre-aggregated product sales metrics for BI consumption"
    columns:
      - name: product_id
        description: "Primary key"
        data_tests:
          - not_null
          - unique
      - name: performance_category
        data_tests:
          - not_null
          - accepted_values:
              values: ['High Performance', 'Medium Performance', 'Low Performance', 'No Sales']
      - name: total_revenue
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

  - name: agg_daily_revenue
    description: "Daily revenue aggregation for BI dashboards"
    columns:
      - name: order_date
        description: "Primary key (one row per day)"
        data_tests:
          - not_null
          - unique
      - name: total_revenue
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
      - name: total_orders
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 1   # if a date exists in this table, at least 1 order happened
      - name: unique_customers
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 1
      - name: total_units_sold
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 1
      - name: total_discounts
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
      - name: avg_unit_price
        data_tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              strictly: true
